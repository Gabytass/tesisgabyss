<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Carrito de Compras</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
  <div class="container mt-5">
    <h2 class="text-center mb-4">ðŸ›’ Carrito de Compras</h2>

    <!-- Mensajes flash -->
    {% with mensajes = get_flashed_messages(with_categories=true) %}
      {% if mensajes %}
        {% for categoria, mensaje in mensajes %}
          <div class="alert alert-{{ categoria }} alert-dismissible fade show" role="alert">
            {{ mensaje }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% if carrito %}
      <table class="table table-bordered table-striped align-middle">
        <thead class="table-dark">
          <tr>
            <th>#</th>
            <th>Producto</th>
            <th class="text-end">Precio</th>
            <th class="text-center">Cantidad</th>
            <th class="text-end">Subtotal</th>
            <th>Imagen</th>
            <th>AcciÃ³n</th>
          </tr>
        </thead>
        <tbody>
          {% for item in carrito %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ item['nombre'] }}</td>
            <td class="text-end">${{ '%.2f' | format(item.get('precio', 0)) }}</td>
            <td class="text-center">
              <div class="d-inline-flex align-items-center gap-2">
                <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('carrito_disminuir', id_producto=item['id']) }}">âˆ’</a>
                <span class="fw-bold">{{ item.get('cantidad', 1) }}</span>
                <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('carrito_aumentar', id_producto=item['id']) }}">+</a>
              </div>
            </td>
            <td class="text-end">
              ${{ '%.2f' | format(item.get('precio',0) * item.get('cantidad',1)) }}
            </td>
            <td>
              {% set img_url = item['imagen'] if item['imagen'].startswith('http') else url_for('static', filename=item['imagen']) %}
              <img src="{{ img_url }}" alt="img" width="80" />
            </td>
            <td>
              <form action="{{ url_for('eliminar_del_carrito', id_producto=item['id']) }}" method="POST" onsubmit="return confirm('Â¿Eliminar este producto?')">
                <button class="btn btn-sm btn-danger">Eliminar</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Total general -->
      <div class="text-end mb-4">
        <h4>Total: <span class="text-success">${{ '%.2f' | format(total) }}</span></h4>
      </div>

      <!-- Botones de acciones -->
      <div class="d-flex justify-content-between mb-4">
        <form action="{{ url_for('vaciar_carrito') }}" method="POST" onsubmit="return confirm('Â¿Vaciar carrito?')">
          <button class="btn btn-warning">Vaciar Carrito</button>
        </form>

        <form action="{{ url_for('finalizar_compra') }}" method="GET">
          <button class="btn btn-success">Finalizar Compra</button>
        </form>
      </div>

    {% else %}
      <p class="text-center fs-5 text-muted">No hay productos en el carrito.</p>
    {% endif %}

    <div class="text-center">
      <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">Volver al CatÃ¡logo</a>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

